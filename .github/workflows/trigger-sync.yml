name: Trigger Agent Hub Sync

# This workflow goes in the Industry-Agent-Demos repo
# It triggers the AgentDemoHub batch sync when solutions are added/updated

on:
  push:
    branches:
      - main
    paths:
      - '*/README.md'      # Any folder's README changed
      - '*/**.zip'         # Any zip file changed
      - '*/'               # Any new folder created

jobs:
  trigger-sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Get changed folders
        id: changes
        run: |
          # Get unique folder names from changed files
          FOLDERS=$(echo "${{ github.event.head_commit.modified }}" | grep -oE '^[^/]+' | sort -u | tr '\n' ',' | sed 's/,$//')
          if [ -z "$FOLDERS" ]; then
            FOLDERS="ALL"
          fi
          echo "folders=$FOLDERS" >> $GITHUB_OUTPUT
          echo "Changed folders: $FOLDERS"

      - name: Trigger AgentDemoHub batch sync
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GH_PAT }}" \
            https://api.github.com/repos/promptclickrun/AgentDemoHub/dispatches \
            -d '{"event_type": "solutions-updated", "client_payload": {"folders": "${{ steps.changes.outputs.folders }}"}}'
          
          echo "âœ… Triggered AgentDemoHub batch sync workflow"
